#*******************************
# ABOUT THIS FILE
#
# sourced by both bashrc and zshrc; non-interactive shells;
# essentially, this is sourced in in *all* cases
#*******************************

set -o vi

if [ -f "$HOME/bin/agent" ]
then
  . $HOME/bin/agent
fi

# Better than using ssh-agent directly; also detects if the agent we
# just loaded is invalid.
if [ -d ~/.ssh ] && which keychain >/dev/null 2>&1
then
  eval $(keychain --inherit any --eval "$(cd ~/.ssh ; \ls | grep -P '(id_|github)' | grep -v pub)")
fi

umask 022

stty echoe 2>/dev/null
stty -ixon 2>/dev/null
stty flush '^@' 2>/dev/null
stty start '^@' 2>/dev/null
stty stop '^@' 2>/dev/null
stty susp '^Z' 2>/dev/null

export VISUAL="/usr/bin/vim"
export EDITOR="/usr/bin/vim"

export LESSBINFMT='*d\%o'
export LESS=-eRM
export PAGER='less'
export MANPAGER='less -isR'
export MANPATH=/usr/local/man:/usr/local/share/man:$MANPATH
export TMOUT=0

# Try to sort correctly
export LANG=en_US.UTF-8
export LC_COLLATE=C

alias rm='rm -v -I'

alias svim="sudo -i \vim"

# Sorting issues
alias ls='LC_ALL=C ls -AF --color=auto'
alias sort='LC_ALL=C sort'

# Privacy issues
alias gist='gist -p'

# Spelling mistakes
alias les='less'
alias gerp=grep

# todo.sh
if [ -x ~/Dropbox/Private/todo/todo.sh ]
then
  ln -sf ~/Dropbox/Private/todo/todo.sh ~/bin/todo.sh
  alias t=~/bin/todo.sh
fi

# better default
alias tmux='TERM=xterm-256color tmux -2 -u '

# Yay forests
ps () {
  /bin/ps --forest -f -e "$@"
}
pg () {
  /bin/ps --forest -f -e | grep "$@"
}

# stolen from cizra in #jbopre
alias g=git
alias gd='g diff -w'
alias gdc='g diff -w --cached'
alias gs='g status --short'
alias ga='g add'
alias gf='g fetch'
alias gr='g rebase'
alias gst='g stash'
alias gp='g pull ; g push'
alias gb='g branch'
alias gc='g commit'
alias gca='g commit -a'
# alias gcah='g commit --amend -C HEAD'  # amend the last commit keeping the same commit message
alias gl='g log --pretty=format:"%Cblue%h%Creset%x09%an%x09 %ar%x09%s" --graph'
alias gin='gl ..@{u}'  # [w]hat's [i]ncoming; useful after a gf (git fetch)
alias gout='gl @{u}..'  # what's [u]npushed; useful before a gp (git push)

# Text only
alias a='ag -t --hidden'
alias ai='ag -ti --hidden'
alias al='ag -tl --hidden'
alias ail='ag -til --hidden'
# Also binary
alias ab='ag -a --hidden'
alias abi='ag -ai --hidden'
alias abl='ag -al --hidden'
alias abil='ag -ail --hidden'

# Easier lsof
alias li='sudo lsof -Pnl -i | grep LIST '
alias lsof='sudo lsof -Pnl -i '

unset RUBYOPT

if [ -x ~/bin/dropbox ]
then
  ~/bin/dropbox start
fi

if [ -f ~/.selinux_functions ]
then
  . ~/.selinux_functions
else
  sefindif() {
    echo "Go to vrici"
  }
  seshowif() {
    echo "Go to vrici"
  }
  sefinddef() {
    echo "Go to vrici" 
  }
  seshowdef() {
    echo "Go to vrici" 
  }
  sefindcon() {
    echo "Go to vrici" 
  }
  selist() {
    echo "Go to vrici" 
  }
fi

# work-specific but whatever
alias myro='sudo -u mysql mysql -u readonly cytobank_development'
alias myrw='sudo -u mysql mysql -u root --safe-updates cytobank_development'
export CBC=/opt/cytobank/releases/current/WEB-INF/config/config.yml
export cbc=/opt/cytobank/releases/current/WEB-INF/config/config.yml

# Do RVM stuff only if it hasn't been done yet
if [ ! "$(which ruby | grep rvm)" ]
then
  # Insert the RVM path, if any, into the middle, by putting the tail
  # on, attaching RVM in front, then adding more.
  export PATH="/sbin:/bin:/usr/sbin:/usr/bin"

  if [ -s "$HOME/.rvm/scripts/rvm" ]
  then
    source "$HOME/.rvm/scripts/rvm" # Load RVM into a shell session *as a function*
  elif [ -s "/usr/local/rvm/scripts/rvm" ]
  then
    source "/usr/local/rvm/scripts/rvm"
  fi
else
  export PATH="$PATH:/sbin:/bin:/usr/sbin:/usr/bin"
fi

export PATH="$HOME/bin:/root/bin:/usr/local/bin/:/usr/local/sbin:$PATH"

export LD_LIBRARY_PATH="/usr/local/lib:$LD_LIBRARY_PATH"

export TERM='screen-256color'

if [ -f $HOME/src/ansible/hacking/env-setup ]
then
  yes | . ~/src/ansible/hacking/env-setup -q
fi

if [ -f $HOME/.bothrc-local ]
then
  . $HOME/.bothrc-local
fi
